{% extends 'nadc/base.html' %}
{% load humanize %}
{% load staticfiles %}
{% load humanize %}

{% block title %}{% endblock %}

{% block morestyles %}
<link rel="stylesheet" href="/static/nadc/donor.css">
{% endblock %}

{% block content %}

<div class="container">

<br><br><br>
<h1><b>{% if name.standard_name %}{{ name.standard_name }}{% else %}{{ name.name }}{% endif %}</b></h1>


{% if gives %}
<h3 class="bold" style="margin-bottom:0;">${{ totalcashdonated.cash__sum|intcomma }}</h3>
<p class="small ital">DONATED</p>
{% endif %}
{% if gets %}
<h3 class="bold" style="margin-bottom:0;">${{ totalcashreceived.cash__sum|intcomma }}</h3>
<p class="small ital">RAISED</p>
{% endif %}
{% if expenditures %}
<h3 class="bold" style="margin-bottom:0;">${{ totalspent.amount__sum|intcomma }}</h3>
<p class="small ital">SPENT</p>
{% endif %}
{% if loans %}
<h3 class="bold" style="margin-bottom:0;">${{ totalborrowed.loan_amount__sum|intcomma }}</h3>
<p class="small ital">BORROWED</p>
{% endif %}







{% comment %}
{% if comm_candidates %}
    <h4>Candidate{{ comm_candidates|pluralize }} supported</h4>
    <ul>
    {% for can in comm_candidates %}
    {% if can.stance == "0" %}
        <li>{{ can.cand_name|title }} ({{ can.office_desc|title }} {{ can.office_title|title }})</li>
    {% endif %}
    {% endfor %}
    </ul>
    {% if comm_candidates.count > 1 %}
    <h4>Candidate{{ comm_candidates|pluralize }} opposed</h4>
    <ul>
    {% for can in comm_candidates %}
    {% if can.stance == "1" %}
        <li>{{ can.cand_name|title }} ({{ can.office_desc|title }} {{ can.office_title|title }})</li>
    {% endif %}
    {% endfor %}
    </ul>
    {% endif %}

{% endif %}
{% endcomment %}

{% if person_candidates %}
    <h4>{% for can in person_candidates %}{% if forloop.first %}{{ can.cand_name|title }}{% endif %}{% endfor %} ran for office {{ person_candidates.count|apnumber }} times.</h4>
    {% for can in person_candidates %}
        <li><a href="/campaign-finance/candidate/{{ can.cand_id }}">{{ can.cand_name|title }} ({{ can.office_desc|title }} {{ can.office_title|title }})</a></li>
    {% endfor %}
{% endif %}
{% with comm_candidates|first as candidate %}    
<p>{{ name.standard_name|title }} {% if name.entity_type = "C" %}is a candidate committee that{% elif name.entity_type = "I" %} is an individual who{% elif name.entity_type = "B" %}is a ballot question committee that{% endif %} {% if gives %}gave {{ gives.count|apnumber|intcomma }} donations{% endif %}{% if not gets %} between {{ first }} and {{ mostrecent }}.{% else %} {% if gives and gets %}and{% endif %} received {{ gets.count|apnumber|intcomma }} contributions between {{ first }} and {{ mostrecent }}. {% endif %}{% if comm_candidates %}It backed {{ candidate.cand_name|title }} for {{ candidate.office_desc|title }} {{ candidate.office_title|title }}.{% endif %}</p>
{% endwith %}



{% if gives %}
	<h2>GIVES</h2>
	
	<h3>Top committees supported</h3>
	
	<table class="table table-condensed">
		{% for row in topgives %}
		<tr>
			<td>{{ row.recipient__name|title }}</td>
			<td class="r">${{ row.total|intcomma }}<td>
		</tr>
		{% endfor %}
	</table>
    
	<div id="timeline" style="width:100%;height:300px"></div>
	
    <table class="table table-condensed">
		<thead>
			<tr>
				<th>Recipient</th>
				<th class="r">Amount</th>
				<th class="r">Date</th>
			</tr>
		</thead>
		
		<tbody>
		{% for gift in gives %}
			<tr>
				<td><a href="/campaign-finance/{{ gift.recipient.nadcid }}/{{ gift.recipient.name|slugify }}">{{ gift.recipient.name|title }}</a></td>
				{% if gift.pledge = 0 %}{% if gift.cash > 0 %}<td class="r">${{ gift.cash|intcomma }}</td>{% else %}<td class="r">${{ gift.inkind|intcomma }}</td>{% endif %}{% endif %}
				<td class="r">{{ gift.donation_date }}</td>
			<tr>
		{% endfor %}

		</tbody>
	</table>

	
{% endif %}

{% if gets %}
	<h2>GETS</h2>

	<h3>Top donors</h3>
		
	<table class="table">
	{% for row in topgets %}
		<tr>
			<td>{{ row.donor__name|title }}</td>
			<td class="r">${{ row.total|intcomma }}</td>
		</tr>
	{% endfor %}
	</table>
	
	
	<table class="table table-condensed">
		<thead>
			<tr>
				<th>Donor</th>
				<th class="r">Amount</th>
				<th class="r">Date</th>
			</tr>
		</thead>
		<tbody>
		
		{% for donation in gets %}
		{% if donation.pledge = 0 %}
			<tr>
				<td><a href="/campaign-finance/{{ donation.donor.canonical }}/{{ donation.donor.name|slugify }}">{{ donation.donor.name|title }}</a></td>
				{% if donation.cash > 0 %}<td class="r">${{ donation.cash|intcomma }}</td>{% else %}<td class="r">${{ donation.inkind|intcomma }}</td>{% endif %}
				<td class="r">{{ donation.donation_date }}</td>
			</tr>
		{% endif %}
		{% endfor %}
		
		</tbody>
	</table>

{% endif %}

{% if expenditures %}

	<h2>EXPENDITURES</h2>
	<table class="table table-condensed">
		<thead>
			<th>Paid to</th>
			<th>For</th>
			<th class="r">Date</th>
			<th class="r">Amount</th>
		</thead>
		<tbody>
		
		{% for exp in expenditures %}
			<tr>
				<td>{{ exp.payee|title }}</td>
				<td>{% if exp.exp_purpose %}{{ exp.exp_purpose|title }}{% else %}Not reported{% endif %}</td>
				<td class="r">{{ exp.exp_date }}</td>
				<td class="r">{% if exp.amount > 0 %}${{ exp.amount|intcomma }}{% else %}${{ exp.in_kind|intcomma }} (In-kind){% endif %}</td>
			</tr>
		{% endfor %}
		</tbody>
	</table>
{% endif %}

{% if loans %}
	<h2>LOANS</h2>
	
	<h3>Loans taken</h3>
	<table class="table table-condensed">
		<thead>
			<tr>
				<th>Lender</th>
				<th>Date borrowed</th>
				<th>Amount</th>
			</tr>
		</thead>
		<tbody>
			{% for loan in loans %}
			{% if loan.loan_amount > 0 %}
			<tr>
				<td>{{ loan.lender_name }}</td>
				<td>{{ loan.loan_date }}</td>
				<td>${{ loan.loan_amount|intcomma  }}</td>
			</tr>
			{% endif %}
			{% endfor %}
		</tbody>
	</table>
	
	<h3>Loans repaid</h3>
	<table class="table table-condensed">
		<thead>
			<tr>
				<th>Lender</th>
				<th>Date repaid</th>
				<th>Amount</th>
			</tr>
		</thead>
		<tbody>
			{% for loan in loans %}
			{% if loan.loan_repaid > 0 %}
			<tr>
				<td>{{ loan.lender_name }}</td>
				<td>{{ loan.loan_date }}</td>
				<td>${{ loan.loan_repaid|intcomma  }}</td>
			</tr>
			{% endif %}
			{% endfor %}
		</tbody>
	</table>

	<h3>Loans forgiven</h3>
	<table class="table table-condensed">
		<thead>
			<tr>
				<th>Lender</th>
				<th>Date repaid</th>
				<th>Amount</th>
			</tr>
		</thead>
		<tbody>
			{% for loan in loans %}
			{% if loan.loan_repaid > 0 %}
			<tr>
				<td>{{ loan.lender_name }}</td>
				<td>{{ loan.loan_date }}</td>
				<td>${{ loan.loan_repaid|intcomma  }}</td>
			</tr>
			{% endif %}
			{% endfor %}
		</tbody>
	</table>
	
{% endif %}


<tr>




{% endblock %}

</div>

{% block scripts %}
<script type="text/javascript">
var timelinegives = [
{% for row in allgives %}
    [{{ forloop.counter }}, {{ row.total }}]{% if not forloop.last %},{% endif %}
{% endfor %}
];
var dataset = [{ data: timelinegives, color: "#5482FF" }];
var ticks = [ {% for row in allgives %}
    [{{ forloop.counter }}, "{{ row.donation_date }}"]{% if not forloop.last %},{% endif %}
    {% endfor %}];
    
var options = {
xaxis: {
  ticks: ticks
},
series: {
    bars: {
        show: true
    }
},
bars: {
    align: "center",
    barWidth: 0.5
}}

 $(document).ready(function () {
            $.plot($("#timeline"), dataset, options);

        });

</script>
{% endblock %}
