{% extends 'nadc/base.html' %}
{% load humanize %}
{% load staticfiles %}
{% load humanize %}

{% block title %}{% endblock %}

{% block morestyles %}
<link rel="stylesheet" href="/static/nadc/donor.css">
{% endblock %}

{% block content %}

<div class="container">

<br><br><br>
<h1><b>{% if name.standard_name %}{{ name.standard_name }}{% else %}{{ name.cand_name }}{% endif %}</b></h1>
{% if name.city and name.state %}<h4>{{ name.city|title }}, {{ name.state }} {{ name.zip }}</h4>{% endif %}
{% if name.dissolved_date %}<h4>(Committee dissolved in {{ name.dissolved_date|date:"o" }}</h4>{% endif %}
{% if name.employer or name.occupation or name.place_of_business %}<h4>{{ name.occupation|title }} at {{ name.employer|title }}, {{ name.place_of_business|title }}</h4>{% endif %}
{% if gets %}<h4><a href="http://www.nadc.nebraska.gov/ccdb/search.cgi?page=details&type=committee&IDNO={{ name.nadcid }}" target="_blank">Official NADC listings</a></h4>{% endif %}


{% if gives %}
<h3 class="bold" style="margin-bottom:0;">${{ totalcashdonated.cash__sum|add:totalinkinddonated.inkind__sum|intcomma }}</h3>
<p class="small ital">DONATED</p>
{% endif %}
{% if gets %}
<h3 class="bold" style="margin-bottom:0;">${{ totalcashreceived.cash__sum|add:totalinkindreceived.inkind__sum|intcomma }}</h3>
<p class="small ital">RAISED</p>
{% endif %}
{% if normal_expenditures %}
<h3 class="bold" style="margin-bottom:0;">${{ normal_spent.amount__sum|intcomma }}</h3>
<p class="small ital">SPENT</p>
{% endif %}
{% if ind_expenditures %}
<h3 class="bold" style="margin-bottom:0;">${{ ind_spent.amount__sum|intcomma }}</h3>
<p class="small ital">SPENT DIRECTLY IN OTHER POLITICAL RACES</p>
{% endif %}
{% if loans %}
<h3 class="bold" style="margin-bottom:0;">${{ totalborrowed.loan_amount__sum|intcomma }}</h3>
<p class="small ital">BORROWED</p>
{% endif %}







{% comment %}
{% if comm_candidates %}
    <h4>Candidate{{ comm_candidates|pluralize }} supported</h4>
    <ul>
    {% for can in comm_candidates %}
    {% if can.stance == "0" %}
        <li>{{ can.cand_name|title }} ({{ can.office_desc|title }} {{ can.office_title|title }})</li>
    {% endif %}
    {% endfor %}
    </ul>
    {% if comm_candidates.count > 1 %}
    <h4>Candidate{{ comm_candidates|pluralize }} opposed</h4>
    <ul>
    {% for can in comm_candidates %}
    {% if can.stance == "1" %}
        <li>{{ can.cand_name|title }} ({{ can.office_desc|title }} {{ can.office_title|title }})</li>
    {% endif %}
    {% endfor %}
    </ul>
    {% endif %}

{% endif %}
{% endcomment %}

{% if person_candidates %}
    <h4>{% for can in person_candidates %}{% if forloop.first %}{{ can.cand_name|title }}{% endif %}{% endfor %} ran for office {{ person_candidates.count|apnumber }} times.</h4>
    {% for can in person_candidates %}
        <li><a href="/campaign-finance/candidate/{{ can.cand_id }}">{{ can.cand_name|title }} ({{ can.office_desc|title }} {{ can.office_title|title }})</a></li>
    {% endfor %}
{% endif %}
   
<p>{{ name.standard_name|title }} {% if gives %}gave {{ gives.count|apnumber|intcomma }} donation{{ gives.count|pluralize }}{% endif %}{% if not gets %} between {{ first }} and {{ mostrecent }}.{% else %} {% if gives and gets %}and{% endif %} received {{ gets.count|apnumber|intcomma }} contribution{{ gets.count|pluralize }} between {{ first }} and {{ mostrecent }}. {% endif %}{% if comm_candidates %}It backed {% for candidate in comm_candidates %}{% if candidate.stance = "0" %}<a href="/campaign-finance/{{ candidate.cand_id }}/{{ candidate.cand_name|slugify }}">{{ candidate.cand_name|title }}</a> for {{ candidate.office_desc|title }} {{ candidate.office_title|title }}{% if not forloop.last %}{% if comm_candidates.count > 2 %}{% if not forloop.last %}, {% else %} and {% endif %} {% else %} and {% endif %}{% endif %}{% endif %}{% endfor %}{% endif %}</p>

{% if gets %}
	<h2>GETS</h2>

	<h3>Top donors</h3>
		
    {% if groupedgets.count > 5 %}<div id="getspiechart" style="width: 900px; height: 500px;"></div>{% endif %}
	
	
	<table class="table table-condensed">
		<thead>
			<tr>
				<th>Donor</th>
				<th class="r">Amount</th>
			</tr>
		</thead>
		<tbody>

		{% for donation in groupedgets %}
			<tr>
				<td><a href="/campaign-finance/{{ donation.donor__nadcid }}/{{ donation.donor__name|slugify }}">{{ donation.donor__name|title }}</a></td>
				<td class="r">${{ donation.total|intcomma }}</td>
			</tr>
		{% endfor %}
		
		</tbody>
	</table>

{% endif %}


{% if gives %}
	<h2>GIVES</h2>
	
	<h3>Top committees supported</h3>
	
    {% if groupedgives.count > 5 %}<div id="givespiechart" style="width: 900px; height: 500px;"></div>{% endif %}
    
	<div id="timeline" style="width:100%;height:300px"></div>

    <table>
		<tbody>
		{% for gift in groupedgives %}
			<tr>
				<td><a href="/campaign-finance/{{ gift.recipient__nadcid }}/{{ gift.recipient__name|slugify }}">{{ gift.recipient__name|title }}</a></td>
				<td class="r">${{ gift.total|intcomma }}</td>
			<tr>
		{% endfor %}

		</tbody>
	</table>

	
{% endif %}

{% if normal_expenditures %}

	<h2>EXPENDITURES</h2>
	<table class="table table-condensed">
		<thead>
			<th>Paid to</th>
			<th>For</th>
			<th class="r">Date</th>
			<th class="r">Amount</th>
		</thead>
		<tbody>
		
		{% for exp in normal_expenditures %}
			<tr>
				<td>{{ exp.payee|title }}</td>
				<td>{% if exp.exp_purpose %}{{ exp.exp_purpose|title }}{% else %}Not reported{% endif %}</td>
				<td class="r">{{ exp.exp_date }}</td>
				<td class="r">{% if exp.amount > 0 %}${{ exp.amount|intcomma }}{% else %}${{ exp.in_kind|intcomma }} (In-kind){% endif %}</td>
			</tr>
		{% endfor %}
		</tbody>
	</table>
{% endif %}

{% if ind_expenditures %}

	<h2>POLITICAL SPENDING</h2>
	<table class="table table-condensed">
		<thead>
			<th>Paid to</th>
			<th>For</th>
			<th class="r">Date</th>
			<th class="r">Amount</th>
		</thead>
		<tbody>
		{% regroup ind_expenditures by stance as stance_list %}
		{% for stance in stance_list %}
        <tr>{{ stance.grouper }}</tr>
        {% for exp in stance.list %}
			<tr>
				<td>{{ exp.payee|title }}</td>
				<td>{% if exp.exp_purpose %}{{ exp.exp_purpose|title }}{% else %}Not reported{% endif %}</td>
				<td class="r">{{ exp.exp_date }}</td>
				<td class="r">{% if exp.amount > 0 %}${{ exp.amount|intcomma }}{% else %}${{ exp.in_kind|intcomma }} (In-kind){% endif %}</td>
			</tr>
		{% endfor %}
        {% endfor %}
		</tbody>
	</table>
{% endif %}

{% if loans %}
	<h2>LOANS</h2>
	
	<h3>Loans taken</h3>
	<table class="table table-condensed">
		<thead>
			<tr>
				<th>Lender</th>
				<th>Date borrowed</th>
				<th>Amount</th>
			</tr>
		</thead>
		<tbody>
			{% for loan in loans %}
			{% if loan.loan_amount > 0 %}
			<tr>
				<td>{{ loan.lender_name }}</td>
				<td>{{ loan.loan_date }}</td>
				<td>${{ loan.loan_amount|intcomma  }}</td>
			</tr>
			{% endif %}
			{% endfor %}
		</tbody>
	</table>
	
	<h3>Loans repaid</h3>
	<table class="table table-condensed">
		<thead>
			<tr>
				<th>Lender</th>
				<th>Date repaid</th>
				<th>Amount</th>
			</tr>
		</thead>
		<tbody>
			{% for loan in loans %}
			{% if loan.loan_repaid > 0 %}
			<tr>
				<td>{{ loan.lender_name }}</td>
				<td>{{ loan.loan_date }}</td>
				<td>${{ loan.loan_repaid|intcomma  }}</td>
			</tr>
			{% endif %}
			{% endfor %}
		</tbody>
	</table>

	<h3>Loans forgiven</h3>
	<table class="table table-condensed">
		<thead>
			<tr>
				<th>Lender</th>
				<th>Date repaid</th>
				<th>Amount</th>
			</tr>
		</thead>
		<tbody>
			{% for loan in loans %}
			{% if loan.loan_repaid > 0 %}
			<tr>
				<td>{{ loan.lender_name }}</td>
				<td>{{ loan.loan_date }}</td>
				<td>${{ loan.loan_repaid|intcomma  }}</td>
			</tr>
			{% endif %}
			{% endfor %}
		</tbody>
	</table>
	
{% endif %}


<tr>




{% endblock %}

</div>

{% block scripts %}
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">

    var gives = [{% for record in gives %}{"donation_date":"{{ record.donation_date|date:"m-d-o" }}", "inkind": {{ record.inkind }}, "cash":{{ record.cash }},  "recipient_id":"{{ record.recipient.nadcid }}", "recipient_name":"{{ record.recipient.standard_name }}"}{% if not forloop.last %},{% endif %}{% endfor %}];

      google.load("visualization", "1", {packages:["corechart"]});
      google.setOnLoadCallback(drawChart);
      function drawChart() {
        var data = google.visualization.arrayToDataTable([
          ['Recipient', 'Dollars'],
          {% for recipient in topgives %}
          ['{{ recipient.recipient__name }}', {{ recipient.total }}]{% if othergivestotal > 0 %},{% endif %}
          {% endfor %}{% if othergivestotal > 0 %}
          ['{{ groupedgives.count|add:-5 }} other committees', {{ othergivestotal }}]
          {% endif %}
        ]);

        var options = {
          title: 'Top committees supported'
        };

        var chart = new google.visualization.PieChart(document.getElementById('givespiechart'));

        chart.draw(data, options);
      }
</script>
<script type="text/javascript">
      var gets = [{% for record in gets %}{"donation_date":"{{ record.donation_date|date:"m-d-o" }}", "inkind": {{ record.inkind }}, "cash":{{ record.cash }},  "donor_id":"{{ record.donor.nadcid }}", "donor":"{{ record.donor.standard_name }}"}{% if not forloop.last %},{% endif %}{% endfor %}];
      google.load("visualization", "1", {packages:["corechart"]});
      google.setOnLoadCallback(drawChart);
      function drawChart() {
        var data = google.visualization.arrayToDataTable([
          ['Donor', 'Dollars'],
          {% for donor in topgets %}
          ['{{ donor.donor__standard_name }}', {{ donor.total }}]{% if othergetstotal > 0 %},{% endif %}
          {% endfor %}
          {% if othergetstotal > 0 %}
          ['{{ groupedgets.count|add:-5 }} other donors', {{ othergetstotal }}]
          {% endif %}
        ]);

        var options = {
          title: 'Top donors'
        };

        var chart = new google.visualization.PieChart(document.getElementById('getspiechart'));

        chart.draw(data, options);
      }
    </script>




<script type="text/javascript">
var timelinegives = [
{% for row in allgives %}
    [{{ forloop.counter }}, {{ row.total }}]{% if not forloop.last %},{% endif %}
{% endfor %}
];
var dataset = [{ data: timelinegives, color: "#5482FF" }];
var ticks = [ {% for row in allgives %}
    [{{ forloop.counter }}, "{{ row.donation_date }}"]{% if not forloop.last %},{% endif %}
    {% endfor %}];
    
var options = {
xaxis: {
  ticks: ticks
},
series: {
    bars: {
        show: true
    }
},
bars: {
    align: "center",
    barWidth: 0.5
}}

 $(document).ready(function () {
            $.plot($("#timeline"), dataset, options);

        });

</script>
{% endblock %}


